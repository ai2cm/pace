

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Communication &mdash; Pace  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Utilities" href="utilities.html" />
    <link rel="prev" title="State" href="state.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Pace
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fv3.html">FV3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">pace-util</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="state.html">State</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#halo-updates">Halo Updates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tilepartitioner">TilePartitioner</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boundary">Boundary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quantity">Quantity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comm">Comm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tilecommunicator">TileCommunicator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cubedspherecommunicator">CubedSphereCommunicator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="utilities.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html">Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../physics/index.html">pace-physics</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pace</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">pace-util</a> &raquo;</li>
        
      <li>Communication</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/util/communication.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="communication">
<span id="id1"></span><h1>Communication<a class="headerlink" href="#communication" title="Permalink to this headline">¶</a></h1>
<p>As mentioned when discussing <a class="reference internal" href="state.html#state"><span class="std std-ref">State</span></a>, each process or “rank” on a cubed sphere is responsible for a subset of the cubed sphere grid.
In order to operate, the model needs to know how to partition that cubed sphere into parts for each rank, and to be able to communicate data between those ranks.</p>
<p>Partitioning is managed by so-called “Partitioner” objects.
The <a class="reference internal" href="api.html#pace.util.CubedSpherePartitioner" title="pace.util.CubedSpherePartitioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.CubedSpherePartitioner</span></code></a> manages the entire cubed sphere, while the <a class="reference internal" href="api.html#pace.util.TilePartitioner" title="pace.util.TilePartitioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.TilePartitioner</span></code></a> manages one of the six faces of the cube, or a region on one of those faces.
For communication, we similarly have <a class="reference internal" href="api.html#pace.util.CubedSphereCommunicator" title="pace.util.CubedSphereCommunicator"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.CubedSphereCommunicator</span></code></a> and <a class="reference internal" href="api.html#pace.util.TileCommunicator" title="pace.util.TileCommunicator"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.TileCommunicator</span></code></a>.
Please see their API documentation for an up-to-date list of current communications routines.</p>
<div class="section" id="halo-updates">
<h2>Halo Updates<a class="headerlink" href="#halo-updates" title="Permalink to this headline">¶</a></h2>
<p>Let’s walk through a detailed example where we create everything we need to perform halo updates on a cubed sphere, to get a feel for the responsibilities of all involved classes. Here we assume that you already know what halo updates are and how data is partitioned in memory-parallel earth system models. If not, there is a (very brief) explanation in the <a class="reference internal" href="state.html#state"><span class="std std-ref">State</span></a> section, or we recommend searching for information on the “Ghost Cell Pattern” or “Halo Exchange”.</p>
<div class="section" id="tilepartitioner">
<h3>TilePartitioner<a class="headerlink" href="#tilepartitioner" title="Permalink to this headline">¶</a></h3>
<p>First, we create a <a class="reference internal" href="api.html#pace.util.TilePartitioner" title="pace.util.TilePartitioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.TilePartitioner</span></code></a> object:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pace.util</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">partitioner</span> <span class="o">=</span> <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">TilePartitioner</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>This partitioner will be responsible for partitioning the data on a single face of the cubed sphere into a single tile.
The <code class="xref py py-attr docutils literal notranslate"><span class="pre">pace.util.TilePartitioner.layout</span></code> attribute is a tuple of two integers, which specifies how many ranks (processors) to partition the cubed sphere into in the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> directions.
For a (1, 1) layout, only one rank will be responsible for each tile face.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">partitioner</span><span class="o">.</span><span class="n">layout</span>
<span class="go">(1, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">partitioner</span><span class="o">.</span><span class="n">total_ranks</span>
<span class="go">1</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="api.html#pace.util.TilePartitioner" title="pace.util.TilePartitioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.TilePartitioner</span></code></a> object is a concrete implementation of the <code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.Partitioner</span></code> abstract base class. Partitioners are responsible for telling us how data on a global model domain is partitioned between ranks, given information about the shapes of the global or local domain and staggering of the data. They do not themselves store this information, meaning the same partitioner can be used to partition data at varying resolutions or with different grid staggering.</p>
</div>
<div class="section" id="boundary">
<h3>Boundary<a class="headerlink" href="#boundary" title="Permalink to this headline">¶</a></h3>
<p>Within the halo update code, a very important feature of the partitioner is the method <code class="xref py py-meth docutils literal notranslate"><span class="pre">pace.util.Partitioner.boundary()</span></code>, which returns a <code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.Boundary</span></code> object:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">boundary</span> <span class="o">=</span> <span class="n">partitioner</span><span class="o">.</span><span class="n">boundary</span><span class="p">(</span><span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">EAST</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">boundary</span>
<span class="go">SimpleBoundary(from_rank=0, to_rank=0, n_clockwise_rotations=0, boundary_type=1)</span>
</pre></div>
</div>
<p>Boundary objects are responsible for describing the boundary between two neighboring ranks, and can tell us what part of a rank’s data is on the boundary through its <code class="xref py py-meth docutils literal notranslate"><span class="pre">pace.util.Boundary.send_view()</span></code> method, and where the neighboring rank’s data belongs in the local halo through its <code class="xref py py-meth docutils literal notranslate"><span class="pre">pace.util.Boundary.recv_view()</span></code> method. As a user you generally will not need to interact with Boundary objects, but they are important to understand if you need to modify or extend the communication code.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">pace.util.Partitioner.boundary()</span></code> method will need to be refactored in the future to support non-square layouts.
The method currently assumes that for a given direction there will be one rank in that direction, but this is not true for tile edges in non-square layouts, and this assumption is not required elsewhere in the code.
Likely the method should be refactored into one that returns an iterable of all boundaries for a given rank.</p>
</div>
</div>
<div class="section" id="quantity">
<h3>Quantity<a class="headerlink" href="#quantity" title="Permalink to this headline">¶</a></h3>
<p>To see how the boundary and other objects operate, we will need some data to operate on. We use a <a class="reference internal" href="api.html#pace.util.Quantity" title="pace.util.Quantity"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.Quantity</span></code></a> object to store the data and all required information about its staggering and halo data:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">quantity</span> <span class="o">=</span> <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">X_DIM</span><span class="p">,</span> <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Y_DIM</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>This creates a cell-centered Quantity with 8x8x6 data points, and 2 halo points in each direction.
The <a class="reference internal" href="api.html#pace.util.Quantity.view" title="pace.util.Quantity.view"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pace.util.Quantity.view</span></code></a> attribute provides convenient indexing into the compute domain.
We can see the extent (size) of the compute domain described by the extent of the quantity:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">quantity</span><span class="o">.</span><span class="n">view</span><span class="p">[:]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4, 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">quantity</span><span class="o">.</span><span class="n">extent</span>
<span class="go">(4, 4)</span>
</pre></div>
</div>
<p>Given a Quantity, the Boundary object can tell us where the data on the boundary is located:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">quantity</span><span class="o">.</span><span class="n">view</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">quantity</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
<span class="go">array([[ 0.,  0.,  0.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  1.,  2.,  3.,  0.],</span>
<span class="go">       [ 0., 10., 11., 12., 13.,  0.],</span>
<span class="go">       [ 0., 20., 21., 22., 23.,  0.],</span>
<span class="go">       [ 0., 30., 31., 32., 33.,  0.],</span>
<span class="go">       [ 0.,  0.,  0.,  0.,  0.,  0.]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">boundary</span><span class="o">.</span><span class="n">send_slice</span><span class="p">(</span><span class="n">quantity</span><span class="o">.</span><span class="n">halo_spec</span><span class="p">(</span><span class="n">n_halo</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="go">(slice(4, 5, None), slice(1, 5, None))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">quantity</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">boundary</span><span class="o">.</span><span class="n">send_slice</span><span class="p">(</span><span class="n">quantity</span><span class="o">.</span><span class="n">halo_spec</span><span class="p">(</span><span class="n">n_halo</span><span class="o">=</span><span class="mi">1</span><span class="p">))]</span>
<span class="go">array([[30., 31., 32., 33.]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">boundary</span><span class="o">.</span><span class="n">recv_slice</span><span class="p">(</span><span class="n">quantity</span><span class="o">.</span><span class="n">halo_spec</span><span class="p">(</span><span class="n">n_halo</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="go">(slice(5, 6, None), slice(1, 5, None))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Boundary also has some older <code class="xref py py-meth docutils literal notranslate"><span class="pre">pace.util.Boundary.send_view()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">pace.util.Boundary.recv_view()</span></code> methods which provide similar functionality.
The original halo update code used these, while a newer pathway that involves building a HaloUpdater and pre-compiling some efficient kernels for data packing uses the “slice” methods.</p>
</div>
</div>
<div class="section" id="comm">
<h3>Comm<a class="headerlink" href="#comm" title="Permalink to this headline">¶</a></h3>
<p>We’ve established some objects for containing data and how it is partitioned, but we still need to actually perform the communication.
The low-level object responsible for this is the <a class="reference internal" href="api.html#pace.util.Comm" title="pace.util.Comm"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.Comm</span></code></a> abstract base class.
This mirrors the comm object provided by the <a class="reference external" href="https://mpi4py.readthedocs.io/en/stable/">mpi4py</a> package, which is a thin wrapper over MPI.
There are multiple Comm classes available.
Under normal circumstances when running a parallel model you will want to use a <a class="reference internal" href="api.html#pace.util.MPIComm" title="pace.util.MPIComm"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.MPIComm</span></code></a> object, which is a wrapper around an <a class="reference external" href="https://mpi4py.readthedocs.io/en/stable/">mpi4py</a> communicator:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pace.util</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">comm</span> <span class="o">=</span> <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">MPIComm</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">comm</span>
<span class="go">&lt;pace.util.mpi.MPIComm object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>
<span class="go">1</span>
</pre></div>
</div>
<p>However this documentation is unit tested, and when it’s unit tested it’s run on only one rank.
For this reason, many of our tests use the <a class="reference internal" href="api.html#pace.util.NullComm" title="pace.util.NullComm"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.NullComm</span></code></a> object, which is a fake communicator that pretends to be an MPI communicator but does not actually perform any communication:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">comm</span> <span class="o">=</span> <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">NullComm</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_ranks</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">comm</span>
<span class="go">NullComm(rank=0, total_ranks=6)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>
<span class="go">6</span>
</pre></div>
</div>
<p>This is very useful for testing code that relies on multi-rank communication without actually running a parallel model, at the expense of not being able to rely on or test the numerical values being output.
Keep this in mind below, where we will avoid showing output values after halo updates because the NullComm cannot actually update them.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to update <a class="reference internal" href="api.html#pace.util.LocalComm" title="pace.util.LocalComm"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.LocalComm</span></code></a> so that it could show a true halo update on one rank, but this is not currently implemented.
The halo update code currently relies on an assumption that only one boundary exists between any pair of ranks, which is not true for a periodic domain with anything less than a 3x3 tile layout.
If this does get implemented, this example should be updated (at least for the tile communication case).</p>
</div>
</div>
<div class="section" id="tilecommunicator">
<h3>TileCommunicator<a class="headerlink" href="#tilecommunicator" title="Permalink to this headline">¶</a></h3>
<p>Halo updates and other communication is performed by the <a class="reference internal" href="api.html#pace.util.Communicator" title="pace.util.Communicator"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.Communicator</span></code></a> abstract base class.
Code that relies only on the abstract base class should be able to run on any Communicator, including both the <code class="xref py py-class docutils literal notranslate"><span class="pre">TileCommunicator`</span></code> which provides a single doubly-periodic tile, or the <code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.CubedSphereCommunicator`</span></code> which provides a cubed sphere decomposition.
We’ll start with the single-tile case.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">comm</span> <span class="o">=</span> <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">NullComm</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_ranks</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">partitioner</span> <span class="o">=</span> <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">TilePartitioner</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tile_communicator</span> <span class="o">=</span> <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">TileCommunicator</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">partitioner</span><span class="p">)</span>
</pre></div>
</div>
<p>With all of these objects in place, we can perform an in-place halo update:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tile_communicator</span><span class="o">.</span><span class="n">halo_update</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>An asynchronous halo update can also be performed:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">request</span> <span class="o">=</span> <span class="n">tile_communicator</span><span class="o">.</span><span class="n">start_halo_update</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
<p>The communicator provides other communication routines, including scatter/gather and a routine to synchronize interface data computed on both ranks neighboring a boundary.</p>
</div>
<div class="section" id="cubedspherecommunicator">
<h3>CubedSphereCommunicator<a class="headerlink" href="#cubedspherecommunicator" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="api.html#pace.util.CubedSphereCommunicator" title="pace.util.CubedSphereCommunicator"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.CubedSphereCommunicator</span></code></a> provides a cubed sphere decomposition of the sphere.
It is used identically to the TileCommunicator, which is by design so that the same code can be used for both decompositions.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">comm</span> <span class="o">=</span> <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">NullComm</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_ranks</span><span class="o">=</span><span class="mi">54</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">partitioner</span> <span class="o">=</span> <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">CubedSpherePartitioner</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">TilePartitioner</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">communicator</span> <span class="o">=</span> <span class="n">pace</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">CubedSphereCommunicator</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">partitioner</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">communicator</span><span class="o">.</span><span class="n">halo_update</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="api.html#pace.util.CubedSpherePartitioner" title="pace.util.CubedSpherePartitioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.CubedSpherePartitioner</span></code></a> is a wrapper around a <a class="reference internal" href="api.html#pace.util.TilePartitioner" title="pace.util.TilePartitioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">pace.util.TilePartitioner</span></code></a> that provides a cubed sphere decomposition.
Within its implementation, it relies entirely on the TilePartitioner to describe how data is partitioned within any given tile, and only imposes constraints on how tiles are ordered and connected to each other.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="utilities.html" class="btn btn-neutral float-right" title="Utilities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="state.html" class="btn btn-neutral float-left" title="State" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, AI2 Climate Modeling Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>